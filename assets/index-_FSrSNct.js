import{_ as se,u as re,r as m,o as de,q as L,b as C,d as s,e as o,j as p,f as r,g as n,F as B,y as me,h as b,t as N,z as ue,m as ce,p as x,k as F,A as ge,n as pe,D as ve,B as _e,x as v,C as O}from"./index-BlQcYuVy.js";const ye={class:"page_wrapper"},fe={class:"page_header"},be={class:"text"},Ue={class:"btn"},Pe={class:"card_box"},Ve={class:"cell product_name"},Ie={class:"tdesign-demo-image-viewer__base"},Ce={class:"tdesign-demo-image-viewer__ui-image"},Ne=["alt","src"],xe=["onClick"],De={class:"cell"},he={class:"cell",style:{display:"flex","justify-content":"center"}},ke={class:"cell"},we={class:"tdesign-demo-item--locale-provider-base"},Se={class:"custom_dialog"},ze={class:"close_wrapper"},qe={key:1},Le={__name:"index",setup(Be){const T=re(),f=m(!1);function A(){f.value=!f.value}const E={categoryId:[{required:!0,message:"Please select a category",type:"error"}],commodityName:[{required:!0,message:"Please enter product name",type:"error"}],commodityDesc:[{required:!0,message:"Please enter product description",type:"error"}],mainImageUrl:[{required:!0,message:"Please upload product cover image",type:"error"}],imageUrl:[{required:!0,message:"Please upload detail images",type:"error"}]},a=m({categoryId:"",commodityName:"",commodityDesc:"",mainImageUrl:"",imageUrl:"",quantity:1,pointsPrice:1}),K=m(null),R=m(null),U=m([]),P=m([]);function D({file:l}){v.error(`文件 ${l.name} 上传失败`)}function h({context:l,fieldName:e}){console.log("upload file success:",l,e);let i=l?.fileList;a.value[e]=i.map(u=>u.response.fileName).join(",")}const _=m(!1),k=m(null),w=L(async()=>{if(_.value||await k.value.validate()!==!0)return;console.log("Submit",a.value),_.value=!0;const e={id:a.value.id,categoryId:a.value.categoryId,commodityName:a.value.commodityName,commodityDesc:a.value.commodityDesc,mainImageUrl:a.value.mainImageUrl,imageUrl:a.value.imageUrl,quantity:a.value.quantity,pointsPrice:a.value.pointsPrice},i=await O(e).finally(()=>{_.value=!1,f.value=!1});console.log("Submit res",i),i.code===0?(v.success(i.msg),V()):v.error(i.msg)},500);function I(l){a.value=JSON.parse(JSON.stringify(l)),U.value=[],P.value=[],a.value.mainImageUrl&&(U.value=[{url:a.value.mainImageAccessUrl,response:{accessUrl:a.value.mainImageAccessUrl,fileName:a.value.mainImageUrl}}]),a.value.imageUrl&&(P.value=a.value.imageUrl.split(",").map((e,i)=>({url:a.value.imageUrlList?.[i],response:{accessUrl:a.value.imageUrlList?.[i],fileName:e}}))),A()}function M(l){const e=ve.confirm({header:"Confirm to delete",theme:"warning",body:"This operation cannot be undone!",confirmBtn:"Delete",cancelBtn:"Cancel",onConfirm:async()=>{e.setConfirmLoading(!0);const i=await _e(l.id);console.log("delete",i),i.code===0?(v.success(i.msg),V()):v.error(i.msg),e.destroy()}})}m(1);const d=m({data:[],page:1,size:10,total:0,loading:!1}),V=L(async()=>{d.value.loading=!0;const l={current:d.value.page,limit:d.value.size},e=await me(l).finally(()=>{d.value.loading=!1});console.log("tableData",e),e.code===0&&(d.value.data=e.data.records,d.value.total=e.data.total,d.value.data.forEach(i=>{y.value[i.id]=i.enbled}))},500);de(()=>{V()});function $({current:l,pageSize:e,previous:i}){console.log("handlePageOrSizeChange",{current:l,pageSize:e,previous:i}),V()}const y=m({});function j(l){return async()=>{console.log(l),y.value[l.id]=!y.value[l.id];const e={id:l.id,enabled:l.enabled?0:1},{code:i,msg:u}=await O(e).finally(()=>{y.value[l.id]=!y.value[l.id]});return console.log(i,u),i===0?(v.success(u),l.enabled=e.enabled):v.error(u),!1}}return(l,e)=>{const i=r("icon-star"),u=r("t-icon"),W=r("t-button"),J=r("BrowseIcon"),Q=r("t-image-viewer"),G=r("t-switch"),S=r("a-button"),H=r("t-base-table"),X=r("t-pagination"),Y=r("t-config-provider"),Z=r("icon-close"),ee=r("t-radio"),te=r("t-radio-group"),c=r("t-form-item"),ae=r("t-input"),oe=r("t-textarea"),z=r("t-upload"),q=r("t-input-number"),le=r("icon-loading"),ie=r("t-form"),ne=r("a-modal");return b(),C(B,null,[s("div",ye,[s("div",fe,[s("div",be,[o(i,{style:{"margin-right":"0.5rem"}}),e[14]||(e[14]=p("Points are earned for listed products "))]),s("div",Ue,[o(W,{variant:"text",theme:"default",style:{padding:"2rem","font-size":"1.2rem"},onClick:e[0]||(e[0]=t=>I({categoryId:"",commodityName:"",commodityDesc:"",mainImageUrl:"",imageUrl:"",quantity:1,pointsPrice:1}))},{icon:n(()=>[o(u,{name:"upload",style:{"margin-right":"1rem",scale:"1.4"}})]),default:n(()=>[e[15]||(e[15]=p(" Listed Products "))]),_:1,__:[15]})])]),s("div",Pe,[e[20]||(e[20]=s("div",{class:"title"},"My Products",-1)),o(H,{size:"large",tableLayout:"auto",hover:"",headerAffixedTop:"","row-key":"index",data:d.value.data,columns:[{colKey:"commodityName",title:"Product Name",ellipsis:!0},{colKey:"schoolName",title:"School",ellipsis:!0},{colKey:"categoryName",title:"Category",ellipsis:!0,align:"center"},{colKey:"pointsPrice",title:"Price",width:"150",align:"center"},{colKey:"enabled",title:"Listing Status",width:"100",align:"center"},{colKey:"operation",title:"Operation",width:"150",align:"center",fixed:l.right}],loading:d.value.loading},{commodityName:n(({row:t})=>[s("div",Ve,[s("div",Ie,[o(Q,{images:[t.mainImageAccessUrl]},{trigger:n(({open:g})=>[s("div",Ce,[s("img",{alt:t.commodityName,src:t.mainImageAccessUrl,class:"tdesign-demo-image-viewer__ui-image--img"},null,8,Ne),s("div",{class:"tdesign-demo-image-viewer__ui-image--hover",onClick:g},[s("span",null,[o(J,{size:"1.4em"}),e[16]||(e[16]=p("Preview"))])],8,xe)])]),_:2},1032,["images"])]),p(" "+N(t.commodityName),1)])]),pointsPrice:n(({row:t})=>[s("div",De,"$"+N(parseInt(t.pointsPrice).toFixed(2)),1)]),enabled:n(({row:t})=>[s("div",he,[o(G,{modelValue:t.enabled,"onUpdate:modelValue":g=>t.enabled=g,size:"large",loading:y.value[t.id],customValue:[1,0],beforeChange:j(t)},null,8,["modelValue","onUpdate:modelValue","loading","beforeChange"])])]),operation:n(({row:t})=>[s("div",ke,[o(S,{type:"text",onClick:g=>I(t)},{default:n(()=>e[17]||(e[17]=[p("Edit")])),_:2,__:[17]},1032,["onClick"]),o(S,{type:"text",status:"danger",onClick:g=>M(t)},{default:n(()=>e[18]||(e[18]=[p("Delete")])),_:2,__:[18]},1032,["onClick"])])]),empty:n(()=>e[19]||(e[19]=[s("span",{style:{display:"flex","align-items":"center","justify-content":"center",height:"100px",color:"rgba(0, 0, 0, 0.26)"}}," No Data ",-1)])),_:1},8,["data","columns","loading"]),o(Y,{"global-config":{pagination:{itemsPerPage:"{size} / page",jumpTo:"jump to",page:"",total:"Total {total} items"}}},{default:n(()=>[s("div",we,[o(X,{modelValue:d.value.page,"onUpdate:modelValue":e[1]||(e[1]=t=>d.value.page=t),total:d.value.total,"max-page-btn":5,onChange:$},null,8,["modelValue","total"])])]),_:1})])]),o(ne,{visible:f.value,"onUpdate:visible":e[13]||(e[13]=t=>f.value=t),width:"auto","hide-title":"",footer:!1,"modal-style":{backgroundColor:"rgba(255, 255, 255, 0)"},"unmount-on-close":""},{default:n(()=>[s("div",Se,[s("div",ze,[o(Z,{style:{position:"relative",bottom:"1rem",left:"1rem"},onClick:e[2]||(e[2]=ue(t=>I({categoryId:"",commodityName:"",commodityDesc:"",mainImageUrl:"",imageUrl:"",quantity:1,pointsPrice:1}),["stop"]))})]),e[21]||(e[21]=s("div",{class:"title"},"Listed Products",-1)),o(ie,{ref_key:"formRef",ref:k,rules:E,data:a.value,colon:!0,labelWidth:"30%"},{default:n(()=>[o(c,{label:"Category",name:"categoryId"},{default:n(()=>[o(te,{modelValue:a.value.categoryId,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.categoryId=t)},{default:n(()=>[(b(!0),C(B,null,ce(x(T).categoryList,(t,g)=>(b(),F(ee,{key:g,value:t.dictCode},{default:n(()=>[p(N(t.dictName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(c,{label:"Product Name",name:"commodityName"},{default:n(()=>[o(ae,{modelValue:a.value.commodityName,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.commodityName=t),placeholder:"Please input product name"},null,8,["modelValue"])]),_:1}),o(c,{label:"Description",name:"commodityDesc"},{default:n(()=>[o(oe,{modelValue:a.value.commodityDesc,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.commodityDesc=t),autosize:{minRows:3,maxRows:5},placeholder:"Describe your products"},null,8,["modelValue"])]),_:1}),o(c,{label:"Product Cover",name:"mainImageUrl"},{default:n(()=>[o(z,{ref_key:"coverUploader",ref:K,modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=t=>U.value=t),"image-viewer-props":{closeOnEscKeydown:!0},"size-limit":{size:5,unit:"MB"},action:"/backendAPI/sys/oss/s3/upload",theme:"image",accept:"image/*","auto-upload":!0,"show-image-file-name":!1,locale:{triggerUploadText:{image:"Upload"}},onSuccess:e[7]||(e[7]=t=>h({context:t,fieldName:"mainImageUrl"})),onFail:D},null,8,["modelValue"])]),_:1}),o(c,{label:"Product Detail",name:"imageUrl"},{default:n(()=>[o(z,{ref_key:"detailUploader",ref:R,modelValue:P.value,"onUpdate:modelValue":e[8]||(e[8]=t=>P.value=t),"image-viewer-props":{closeOnEscKeydown:!0},"size-limit":{size:5,unit:"MB"},action:"/backendAPI/sys/oss/s3/upload",theme:"image",accept:"image/*","auto-upload":!0,"show-image-file-name":!1,locale:{triggerUploadText:{image:"Upload"}},multiple:"",max:8,onSuccess:e[9]||(e[9]=t=>h({context:t,fieldName:"imageUrl"})),onFail:D},null,8,["modelValue"])]),_:1}),o(c,{label:"Quantity",name:"quantity"},{default:n(()=>[o(q,{modelValue:a.value.quantity,"onUpdate:modelValue":e[10]||(e[10]=t=>a.value.quantity=t),autoWidth:"",min:1,step:1,decimalPlaces:0},null,8,["modelValue"])]),_:1}),o(c,{label:"Price",name:"pointsPrice"},{default:n(()=>[o(q,{modelValue:a.value.pointsPrice,"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.pointsPrice=t),theme:"normal",autoWidth:"",decimalPlaces:2,min:0,step:.1,label:"$"},null,8,["modelValue"])]),_:1}),s("div",{class:pe(["dialog_main_btn",{disabled:_.value}]),style:ge({cursor:_.value?"not-allowed":"pointer"}),onClick:e[12]||(e[12]=(...t)=>x(w)&&x(w)(...t))},[_.value?(b(),F(le,{key:0})):(b(),C("span",qe,"Submit"))],6)]),_:1},8,["data"])])]),_:1},8,["visible"])],64)}}},Oe=se(Le,[["__scopeId","data-v-3205e3b2"]]);export{Oe as default};
