(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-201ad270","chunk-2d21b8f7"],{1295:function(e,t,a){"use strict";a("35d3")},"35d3":function(e,t,a){},"39aa":function(e,t,a){"use strict";var s=a("9ef2"),i=a("1853"),o=a("36c3"),l=a("c717"),r=a("5723"),c=a("3bfc"),n=a("c9c9"),d=a("006e"),u=d("every",TypeError);s({target:"Iterator",proto:!0,real:!0,forced:u},{every:function(e){r(this);try{l(e)}catch(s){n(this,"throw",s)}if(u)return i(u,this,e);var t=c(this),a=0;return!o(t,(function(t,s){if(!e(t,a++))return s()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},"405a":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"system-carousel-container layout-padding"},[a("el-card",{staticClass:"layout-padding-auto",attrs:{shadow:"hover"}},[a("div",{staticClass:"system-carousel-search mb15"},[e.state.batchOperation.active?e._e():a("el-button",{staticClass:"ml10",attrs:{size:"default",type:"success",icon:"el-icon-plus"},on:{click:function(t){return e.onOpenAddOrEdit("add")}}},[e._v(" Add Carousel ")]),e.state.batchOperation.active?e._e():a("el-button",{staticClass:"ml10",attrs:{size:"default",type:"danger",icon:"el-icon-delete"},on:{click:function(t){return e.startBatchOperation("delete")}}},[e._v(" Batch Delete ")]),e.state.batchOperation.active?e._e():a("el-button",{staticClass:"ml10",attrs:{size:"default",type:"primary",icon:"el-icon-setting"},on:{click:function(t){return e.startBatchOperation("display")}}},[e._v(" Display Settings ")]),e.state.batchOperation.active?[a("el-button",{staticClass:"ml10",attrs:{size:"default",type:"primary"},on:{click:e.confirmBatchOperation}},[e._v("Confirm")]),a("el-button",{staticClass:"ml10",attrs:{size:"default"},on:{click:e.cancelBatchOperation}},[e._v("Cancel")]),a("span",{staticClass:"ml10"},[e._v("Selected "+e._s(e.state.batchOperation.selectedIds.length)+" items")])]:e._e()],2),a("div",{staticClass:"picture_preview_area"},[a("div",{staticClass:"carousel-grid"},e._l(e.state.carouselData,(function(t){return a("div",{key:t.id,staticClass:"carousel-grid-item"},[a("el-card",{class:{"carousel-card":!0,"carousel-card-enabled":1===t.enabled,"carousel-card-selected":e.state.batchOperation.selectedIds.includes(t.id)},attrs:{"body-style":{padding:"0px"}},nativeOn:{click:function(a){return e.onCardClick(t)}}},[a("div",{staticClass:"carousel-image-container"},[a("img",{staticClass:"carousel-image",attrs:{src:t.accessUrl}}),e.state.batchOperation.active?a("div",{staticClass:"carousel-checkbox"},[a("el-checkbox",{on:{change:function(a){return e.handleCheckboxChange(a,t)},click:function(e){e.stopPropagation()}},model:{value:t.selected,callback:function(a){e.$set(t,"selected",a)},expression:"item.selected"}})],1):e._e(),1===t.enabled?a("div",{staticClass:"carousel-status"},[a("el-tag",{attrs:{size:"mini",type:"success"}},[e._v("Enabled")])],1):e._e()])])],1)})),0),0===e.state.carouselData.length?a("el-empty",{attrs:{description:"No carousel images"}}):e._e()],1)]),a("el-dialog",{attrs:{title:e.state.dialog.title,visible:e.state.dialog.isShowDialog,width:"600px"},on:{"update:visible":function(t){return e.$set(e.state.dialog,"isShowDialog",t)}}},[a("div",[a("el-upload",{ref:"upload",staticClass:"carousel-upload-drag",attrs:{action:"/backendAPI/sys/oss/s3/upload","file-list":e.state.uploadList,"on-change":e.handleChange,"on-remove":e.handleRemove,"before-upload":e.beforeUpload,"on-exceed":e.handleExceed,"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,"on-progress":e.handleUploadProgress,"auto-upload":!1,multiple:"",limit:10,"list-type":"picture",drag:""}},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("Drag images here, or "),a("em",[e._v("click to upload")])]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("Only JPG, PNG, GIF or WebP images can be uploaded, up to 2MB each, maximum 10 images")])]),e.state.uploadProgress.show?a("div",{staticClass:"upload-progress"},[a("p",[e._v("Uploading: "+e._s(e.state.uploadProgress.currentFile))]),a("el-progress",{attrs:{percentage:e.state.uploadProgress.percent}})],1):e._e(),[a("span",{staticClass:"dialog-footer"},[a("el-button",{attrs:{size:"default"},on:{click:e.onCancel}},[e._v("Cancel")]),a("el-button",{attrs:{type:"primary",loading:e.state.submitBtn.loading,size:"default"},on:{click:e.onSubmit}},[e._v(e._s(e.state.dialog.submitTxt))])],1)]],2)])],1)},i=[],o=(a("0925"),a("d793"),a("39aa"),a("5044"),a("c127"),a("8f24")),l=a("bffc"),r={name:"carousel",data(){return{state:{carouselData:[],uploadList:[],uploadProgress:{show:!1,percent:0,currentFile:""},batchOperation:{active:!1,type:"",selectedIds:[]},tableData:{loading:!1,param:{current:1,limit:999}},dialog:{isShowDialog:!1,type:"",title:"",submitTxt:""},submitBtn:{loading:!1,type:""}}}},methods:{async fetchData(){this.state.tableData.loading=!0,console.log("获取轮播图列表入参",this.state.tableData.param);const{data:e}=await Object(l["useCarouselApi"])().list(this.state.tableData.param).catch(e=>{console.error("获取轮播图列表失败:",e)});e&&(console.log("获取轮播图列表返回",e),this.state.carouselData=e.records.map(e=>({...e,selected:!1}))),this.state.tableData.loading=!1},onOpenAddOrEdit(e){this.state.uploadList=[],this.state.dialog.type=e,this.state.dialog.title="Upload Carousel Image",this.state.dialog.submitTxt="Start Upload",this.state.dialog.isShowDialog=!0},closeDialog(){this.state.dialog.isShowDialog=!1,this.state.uploadList=[],this.state.uploadProgress.show=!1,this.state.submitBtn.loading=!1},onCancel(){this.closeDialog()},beforeUpload(e){const t=["image/jpeg","image/png","image/gif","image/webp"],a=t.includes(e.type),s=2,i=e.size/1024/1024<s;return a?!!i||(o["Message"].error(`Image size cannot exceed ${s}MB!`),!1):(o["Message"].error("Only JPG, PNG, GIF, or WebP format images are allowed!"),!1)},handleChange(e,t){this.state.uploadList=t},handleRemove(e,t){this.state.uploadList=t},async handleUploadSuccess(e,t,a){if(0===e.code)o["Message"].success(`File ${t.name} upload successful`),await this.createCarouselRecord(e),a.every(e=>"success"===e.status||"fail"===e.status)&&(this.state.submitBtn.loading=!1,o["Message"].success("All images uploaded successfully"),await this.fetchData(),this.closeDialog());else{const a=(null===e||void 0===e?void 0:e.msg)||(null===e||void 0===e?void 0:e.message)||"Unknown error";o["Message"].error(`File ${t.name} upload failed: ${a}`),this.state.submitBtn.loading=!1}},async handleUploadError(e,t,a){console.error("Upload failed:",e);let s="Unknown error";if(e)if("string"===typeof e)s=e;else if(e.message)s=e.message;else if(e.response&&e.response.data){const t=e.response.data;"string"===typeof t?s=t:t.message?s=t.message:t.msg&&(s=t.msg)}o["Message"].error(`File ${t.name} upload failed: ${s}`),this.state.submitBtn.loading=!1;const i=a.every(e=>"success"===e.status||"fail"===e.status);i&&(await this.fetchData(),this.closeDialog())},handleUploadProgress(e,t,a){e&&"undefined"!==typeof e.percent&&(this.state.uploadProgress.show=!0,this.state.uploadProgress.currentFile=t.name,this.state.uploadProgress.percent=Math.floor(e.percent),e.percent>=100&&"success"!==t.status&&"fail"!==t.status&&(this.state.uploadProgress.currentFile=t.name+" (Processing...)"))},async createCarouselRecord(e){const t={enabled:0,imageUrl:e.fileName};console.log("创建轮播图记录入参:",t);const a=await Object(l["useCarouselApi"])().add(t).catch(e=>{console.log("创建轮播图记录失败:",e),o["Message"].error("Create carousel record failed")});if(console.log("创建轮播图记录结果:",a),a&&a.success)return!0},onSubmit(){0!==this.state.uploadList.length?(this.state.uploadProgress={show:!0,percent:0,currentFile:"Preparing upload..."},this.state.submitBtn.loading=!0,this.state.tableData.loading=!0,this.$refs.upload.submit(),this.state.dialog.submitTxt="Uploading..."):o["Message"].warning("Please select images to upload first")},startBatchOperation(e){this.state.batchOperation={active:!0,type:e,selectedIds:[]},this.state.carouselData.forEach(e=>e.selected=!1),"display"===e&&this.state.carouselData.forEach(e=>{1===e.enabled&&(e.selected=!0,this.state.batchOperation.selectedIds.push(e.id))})},cancelBatchOperation(){this.state.batchOperation={active:!1,type:"",selectedIds:[]},this.state.carouselData.forEach(e=>e.selected=!1)},async confirmBatchOperation(){const{selectedIds:e,type:t}=this.state.batchOperation;if(0===e.length)return void o["Message"].warning("Please select at least one item");const a=await o["MessageBox"].confirm("delete"===t?"Are you sure you want to delete the selected images?":"Are you sure you want to display the selected images?","Tip",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).catch(()=>!1);if(a){const a="delete"===t?this.batchDelete:this.batchDisplaySettings;await a(e)}},async batchDelete(e){const t=await Object(l["useCarouselApi"])().delete(e).catch(e=>{o["Message"].error("Delete failed"),console.error("批量删除失败:",e)});t&&(o["Message"].success(t.msg),this.cancelBatchOperation(),await this.fetchData())},async batchDisplaySettings(e){const t=await Object(l["useCarouselApi"])().enable(e).catch(e=>{o["Message"].error("Display settings failed"),console.error("批量展示设置失败:",e)});t&&(o["Message"].success(t.msg),this.cancelBatchOperation(),await this.fetchData())},handleCheckboxChange(e,t){const{selectedIds:a}=this.state.batchOperation;if(e)a.push(t.id);else{const e=a.indexOf(t.id);-1!==e&&a.splice(e,1)}},onCardClick(e){this.state.batchOperation.active&&(e.selected=!e.selected,this.handleCheckboxChange(e.selected,e))},handleExceed(e,t){o["Message"].warning(`File limit is 10. You selected ${e.length} files this time, with a total of ${e.length+t.length} files selected`)},extractErrorMessage(e){var t;if(!e)return"Unknown error";if("string"===typeof e)return e;if(e.message)return e.message;if(null!==(t=e.response)&&void 0!==t&&t.data){const t=e.response.data;return"string"===typeof t?t:t.msg||t.message||"Unknown error"}return"Unknown error"}},mounted(){this.fetchData()}},c=r,n=(a("1295"),a("1805")),d=Object(n["a"])(c,s,i,!1,null,"12f80bda",null);t["default"]=d.exports},bffc:function(e,t,a){"use strict";a.r(t),a.d(t,"useCarouselApi",(function(){return i}));var s=a("b775");function i(){return{list:e=>Object(s["default"])({url:"/busiHomeTop/page",method:"get",params:e}),add:e=>Object(s["default"])({url:"/busiHomeTop/save",method:"post",data:e}),delete:e=>Object(s["default"])({url:"/busiHomeTop/deleteBatch",method:"POST",data:e}),enable:e=>Object(s["default"])({url:"/busiHomeTop/enable",method:"POST",data:e})}}}}]);